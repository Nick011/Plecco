/* 
Author: Nick Hagianis
*/function onYouTubeIframeAPIReady(){ytPlayer=new YT.Player("mainPlayer",{height:"300",width:"600",playerVars:{controls:0,disablekb:1,enablejsapi:1,showinfo:0,wmode:"opaque"},events:{onReady:onPlayerReady}})}function onPlayerReady(a){function c(a){this.socketIn=a.socketIn,this.socketOut=a.socketOut,this.template=Handlebars.compile($(a.template).text()),this.container=$(a.container),delete a.socketIn,delete a.socketOut,delete a.template,delete a.container,this.objects=a}var b=io.connect(window.location.origin+":1337");c.prototype={send:function(a){b.emit(this.socketIn,a)},recieve:function(a){b.on(this.socketOut,function(b){a(b)})}};var d={room:ROOM,session:SESSION,spinning:!1,socketIn:"announce",socketOut:"users",template:"#user-template",container:".audience"},e={socketIn:"post",socketOut:"message",template:"#message-template",container:".messages",input:$("#message")},f={socketIn:"vj_add",socketOut:"video_jokey",template:"#vj-template",container:".vjs",input:$(".vj-container")},g={socketIn:"playlist_add",socketOut:"playlist",template:"#playlist-template",container:".playlist",count:0,add:$(".btn_add"),remove:function(a){b.emit("playlist_remove",a)}},h={socketIn:"player_skip",socketOut:"play",socketSkip:"skip",input:$(".skip-container").children(".btn-alert")},i={socketIn:"search",socketOut:"search",template:"#search-template",container:".results",input:$("#query")},j=new c(d),k=new c(e),l=new c(f),m=new c(g),n=new c(h),o=new c(i);(function(){j.recieve(function(a){j.container.empty().append(j.template({users:a}))}),j.send({session:j.objects.session,slug:j.objects.room})})(),function(){var a=k.objects.input;k.recieve(function(a){k.container.prepend(k.template(a))}),a.parent("form").submit(function(){var b=$(this).serializeObject();return k.send({session:j.objects.session,slug:j.objects.room,body:b.message}),a.val("").focus(),!1})}(),function(){var a=o.objects.input;o.recieve(function(b){if(b.status===0)alert("an error has occured"),alert(b.message);else if(b.q===a.val()){var c=o.template(b);o.container.empty().append(c)}}),a.parent("form").submit(function(){var b=a.serializeObject();return o.send(b),a.focus(),!1}),a.keyup(function(){var b=o.objects,c=a.val().length;if(c>=3){var d=a.serializeObject();setTimeout(function(){d.query===a.val()&&o.send(d)},250)}}),o.container.on("click",".add",function(){m.send({song:$(this).attr("id"),session:SESSION})}),o.container.on("click",".preview",function(){var a=$(this).attr("id");ytPlayer.mute(),$(".overlay_container").show().find("#overlayPlayer").attr("src","http://www.youtube.com/embed/"+a),$(".dimmer").click(function(){$(".overlay_container").hide().find("#overlayPlayer").attr("src",""),ytPlayer.unMute()})})}(),function(){function a(a){var c=a.length;while(c--)a[c]={video:a[c],order:c+1};data={user:j.objects.session,playlist:a},b.emit("playlist_reorder",data)}m.recieve(function(a){var b=m.template({videos:a});m.count=a.length,m.container.empty().append(b)}),m.container.on("click",".remove",function(){m.objects.remove({user:j.objects.session,song:$(this).parent("div").attr("id")})}),m.container.on("click",".top",function(){var b;$(this).parent("div").detach().prependTo(m.container),b=m.container.sortable("toArray"),a(b)}),m.container.sortable({axis:"y",opacity:".7",stop:function(b,c){var d,e=$(this).sortable("toArray");a(e)}})}(),function(){l.recieve(function(a){var b=4,c=[],d;j.objects.spinning=!1;while(b--)a[b]==undefined?c.push({first_name:null,last_name:null}):(a[b].session===j.objects.session&&(j.objects.spinning=!0),c.push(a[b]));c=c.reverse(),d=l.template({vj:c}),l.container.empty().append(d)}),l.container.on("click",".btn-success",function(){m.count?l.send(j.objects.session):alert("You must add videos to your playlist first.")})}(),function(){var a=n.objects.socketSkip,c=n.objects.input;n.recieve(function(a){a[1]?ytPlayer.loadVideoById(a[0].yt_id,a[1]):ytPlayer.loadVideoById(a[0].yt_id)}),c.on("click",function(a){var b={session:SESSION,slug:ROOM,spinning:j.objects.spinning};n.send(b)}),b.on(a,function(a){$(".progress").css("width",a.progress)})}(),function(){var a;$("body").on("mousedown","button",function(){var b=$(this);a=b.css("border-bottom"),b.css("border-bottom","none").css("margin-top","3px")}).on("mouseup","button",function(){$(this).css("border-bottom",a).css("margin-top","0")})}()}$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){var b=this.name;a[b]!==undefined?(a[b].push||(a[b]=[a[b]]),a[b].push(this.value||"")):a[b]=this.value||""}),a};var ytPlayer,ytScriptTag=document.createElement("script"),firstScriptTag=document.getElementsByTagName("script")[0];ytScriptTag.src="//www.youtube.com/iframe_api",firstScriptTag.parentNode.insertBefore(ytScriptTag,firstScriptTag),$.get("/static/template/main.html",function(a){$("head").append(a)});